var ngms;!function(t){"use strict"}(ngms||(ngms={}));var ngms;!function(t){"use strict";var e=angular.module("ngms",[]),s=function(){function t(t,e){this.$channel=t,this.$topicName=e}return t.prototype.getName=function(){return this.$topicName},t.prototype.getChannelName=function(){return this.$channel.getName()},t.prototype.publishSync=function(t){this.$channel.publishSync(this.$topicName,t)},t.prototype.publish=function(t){return this.$channel.publish(this.$topicName,t)},t.prototype.subscribe=function(t){return this.$channel.subscribe(this.$topicName,t)},t.prototype.unsubscribe=function(t){if(t.topicName!==this.$topicName)throw new Error("You can only unsubscribe tokens related to topic "+this.$topicName);this.$channel.unsubscribe(t)},t.prototype.unsubscribeAll=function(){var t=this.$channel.getRegistry(),e=t.getChannelSubs(this.$channel.getName());e[this.$topicName]=[]},t}(),n=function(){function t(t,e){this.$subscriptions={},this.$registry=e,this.$channelName=t}return t.prototype.getRegistry=function(){return this.$registry},t.prototype.getName=function(){return this.$channelName},t.prototype.getDefaultTopic=function(){return new s(this,this.$registry.$defaultTopicName)},t.prototype.getTopic=function(t){return new s(this,t)},t.prototype.publishSync=function(t,e){var s=this.$ensureMessage(e);this.$registry.publishSync(this.$channelName,t,s)},t.prototype.publish=function(t,e){var s=this.$ensureMessage(e);return this.$registry.publish(this.$channelName,t,s)},t.prototype.$ensureMessage=function(t){var e;return t?"string"==typeof t?e={data:t,$msgId:this.$registry.generateUUID()}:(e=t,e.$msgId=this.$registry.generateUUID()):e={$msgId:""},e},t.prototype.subscribeAll=function(t){return this.subscribe(this.$registry.$allTopicsName,t)},t.prototype.subscribe=function(t,e){return this.$subscribe(t,e,!1)},t.prototype.subscribeOneTime=function(t,e){return this.$subscribe(t,e,!0)},t.prototype.$subscribe=function(t,e,s){var n=this.$registry.generateUUID(),i=this.$registry.getTopicSubs(this.$channelName,t),r={channelName:this.$channelName,topicName:t,tokenId:n};return i.push({token:r,callback:e,oneTime:s}),this.$subscriptions[n]=r,r},t.prototype.unsubscribeAll=function(){for(var t in this.$subscriptions)this.unsubscribe(this.$subscriptions[t]);this.$subscriptions={}},t.prototype.unsubscribe=function(t){if(t){if(t.channelName!==this.$channelName)throw new Error("You can only unsubscribe tokens related to channel "+this.$channelName);this.$registry.removeToken(t),delete this.$subscriptions[t.tokenId]}},t}(),i=function(){function t(t,e){this.$allTopicsName="$$all-topics",this.$allChannelsName="$$all-channels",this.$defaultTopicName="$$default-topic",this.$subscribers={},this.$timeout=t,this.$q=e}return t.prototype.getChannelSubs=function(t){return this.$subscribers[t]=this.$subscribers[t]||{},this.$subscribers[t]},t.prototype.getTopicSubs=function(t,e){var s=this.getChannelSubs(t);return s[e]=s[e]||[],s[e]},t.prototype.removeToken=function(t){var e=this.getTopicSubs(t.channelName,t.topicName),s=e.filter(function(e){return e.token.tokenId!==t.tokenId});0===s.length?(delete this.$subscribers[t.channelName][t.topicName],0===Object.keys(this.$subscribers[t.channelName]).length&&delete this.$subscribers[t.channelName]):this.$subscribers[t.channelName][t.topicName]=s},t.prototype.publishSync=function(t,e,s){var n=this.$getSubscriptions(t,e);n.forEach(function(n){n.callback(s,e,t)})},t.prototype.publish=function(t,e,s){var n=this.$getSubscriptions(t,e),i=this;return new this.$q(function(){i.$timeout(function(){n.forEach(function(n){n.callback(s,e,t)})},0)})},t.prototype.$getSubscriptions=function(t,e){var s=this.getTopicSubs(t,e),n=this.getTopicSubs(t,this.$allTopicsName),i=this.getTopicSubs(this.$allChannelsName,this.$allTopicsName);return s.concat(n,i)},t.prototype.generateUUID=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?s:3&s|8).toString(16)});return e},t}(),r=function(){function t(t,e){this.$registry=new i(t,e)}return t.prototype.getChannel=function(t){return new n(t,this.$registry)},t.prototype.getTopic=function(t,e){return new n(t,this.$registry).getTopic(e)},t.prototype.subscribeAllChannelsOneTime=function(t){return this.$subscribeAllChannels(t,!0)},t.prototype.subscribeAllChannels=function(t){return this.$subscribeAllChannels(t,!1)},t.prototype.$subscribeAllChannels=function(t,e){var s=this.$registry.generateUUID(),n=this.$registry.getTopicSubs(this.$registry.$allChannelsName,this.$registry.$allTopicsName),i={channelName:this.$registry.$allChannelsName,topicName:this.$registry.$allTopicsName,tokenId:s};return n.push({token:i,callback:t,oneTime:!1}),i},t.prototype.unsubscribeAllChannels=function(t){if(t.channelName!==this.$registry.$allChannelsName&&t.topicName!==this.$registry.$allTopicsName)throw new Error("MessageService only allows unsubscribe to all-channels subscriptions");this.$registry.removeToken(t)},t.prototype.getRegistryStats=function(){var t={},e=this;return t.totalChannels=Object.keys(this.$registry.$subscribers).length,t.totalTopics=0,t.totalSubscriptions=0,t.channels=[],Object.keys(this.$registry.$subscribers).forEach(function(s){var n=e.$registry.$subscribers[s],i={};i.name=s,i.totalTopics=Object.keys(n).length,i.totalSubscriptions=0,i.topics=[],Object.keys(n).forEach(function(t){var e=n[t],s={};s.name=t,s.totalSubscriptions=e.length,i.totalSubscriptions+=e.length,i.topics.push(s)}),t.totalTopics+=i.totalTopics,t.totalSubscriptions+=i.totalSubscriptions,t.channels.push(i)}),t},t}();e.service("ngmsMessageService",r)}(ngms||(ngms={}));