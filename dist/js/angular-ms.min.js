var ngms;!function(t){"use strict";var e=angular.module("ngms",[]),n=function(){function t(t,e){this.channel=t,this.topicName=e}return t.prototype.getName=function(){return this.topicName},t.prototype.getChannelName=function(){return this.channel.getName()},t.prototype.publish=function(t){this.channel.publish(this.topicName,t)},t.prototype.subscribe=function(t){return this.channel.subscribe(this.topicName,t)},t.prototype.unsubscribe=function(t){this.channel.unsubscribe(t)},t.prototype.unsubscribeAll=function(){var t=this.channel.getRegistry(),e=t.getChannelSubs(this.channel.getName());e[this.topicName]=[]},t}(),i=function(){function t(t,e){this.subscriptions={},this.registry=e,this.channelName=t}return t.prototype.getRegistry=function(){return this.registry},t.prototype.getName=function(){return this.channelName},t.prototype.getTopic=function(t){return new n(this,t)},t.prototype.publish=function(t,e){var n,i=this.channelName;n="string"==typeof e?{data:e,msgId:this.registry.generateUUID()}:e;var s=this.registry.getTopicSubs(this.channelName,t),r=s.filter(function(e){var s=e.callback(n,t,i);return!s});this.registry.subscribers[this.channelName][t]=r},t.prototype.subscribe=function(t,e){var n=this.registry.generateUUID(),i=this.registry.getTopicSubs(this.channelName,t),s={channelName:this.channelName,topicName:t,tokenId:n};return i.push({token:s,callback:e}),this.subscriptions[n]=s,s},t.prototype.unsubscribeAll=function(){for(var t in this.subscriptions)this.unsubscribe(this.subscriptions[t]);this.subscriptions={}},t.prototype.unsubscribe=function(t){if(t){var e=this.registry.getTopicSubs(this.channelName,t.topicName),n=e.filter(function(e){return e.token.tokenId!==t.tokenId});delete this.subscriptions[t.topicName],0===n.length?delete this.registry.subscribers[this.channelName][t.topicName]:this.registry.subscribers[this.channelName][t.topicName]=n,0===Object.keys(this.registry.subscribers[this.channelName]).length&&delete this.registry.subscribers[this.channelName]}},t}(),s=function(){function t(){this.subscribers={}}return t.prototype.getChannelSubs=function(t){return this.subscribers[t]=this.subscribers[t]||{},this.subscribers[t]},t.prototype.getTopicSubs=function(t,e){var n=this.getChannelSubs(t);return n[e]=n[e]||[],n[e]},t.prototype.generateUUID=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)});return e},t}(),r=function(){function t(){this.registry=new s}return t.prototype.getChannel=function(t){return new i(t,this.registry)},t.prototype.getTopic=function(t,e){return new i(t,this.registry).getTopic(e)},t}();e.service("ngmsMessageService",r)}(ngms||(ngms={}));